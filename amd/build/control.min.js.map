{"version":3,"sources":["../src/control.js"],"names":["define","$","Log","PubSub","Ajax","Str","DailyTimetableControl","region","date","instanceid","displaypreference","userid","title","self","role","data","username","prototype","main","refreshPeriodLayout","removeClass","navigatePreviousDay","navigateNextDay","timetableVisibility","window","on","subscribe","debug","breakWidth","numBreaks","timetableWidth","outerWidth","numPeriods","potentialWidth","setPeriodWidth","evenPeriods","Math","round","classes","periodWidth","addClass","find","css","parseInt","call","methodname","args","timetableuser","timetablerole","nav","done","response","refreshLayout","html","fail","reason","error","timetableUnavailable","user","text","savePreferences","value","preferences","htmlResult","fadeOut","replaceWith","show","unavailablestr","get_string","when","localizedString","init","first","length","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Provides the block_my_day_timetable/control module\r\n *\r\n * @package   block_my_day_timetable\r\n * @category  output\r\n * @copyright 2019 Michael Vangelovski, Canberra Grammar School <michael.vangelovski@cgs.act.edu.au>\r\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\n/**\r\n * @module block_my_day_timetable/control\r\n */\r\ndefine(['jquery', 'core/log', 'core/pubsub', 'core/ajax', 'core/str'], function($, Log, PubSub, Ajax, Str) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Initializes the block controls.\r\n     */\r\n    function init(instanceid, date, displaypreference, userid, title) {\r\n        Log.debug('block_my_day_timetable/control: initializing controls of the my_day_timetable block instance ' + instanceid);\r\n        \r\n        var region = $('[data-region=\"block_my_day_timetable-instance-' + instanceid +'\"]').first();\r\n        \r\n        if (!region.length) {\r\n            Log.debug('block_my_day_timetable/control: wrapping region not found!');\r\n            return;\r\n        }\r\n\r\n        var control = new DailyTimetableControl(region, date, instanceid, displaypreference, userid, title); \r\n        control.main();\r\n    }\r\n\r\n    /**\r\n     * Controls a single my_day_timetable block instance contents.\r\n     *\r\n     * @constructor\r\n     * @param {jQuery} region\r\n     */\r\n    function DailyTimetableControl(region, date, instanceid, displaypreference, userid, title) {\r\n        var self = this;        \r\n        self.date = date;               \r\n        self.region = region;\r\n        self.userid = userid;\r\n        self.instanceid = instanceid;\r\n        self.displaypreference = displaypreference;\r\n        self.title = title;\r\n        self.role = region.data(\"timetablerole\");\r\n        self.username = region.data(\"timetableuser\");\r\n    }\r\n\r\n    /**\r\n     * Run the controller.\r\n     *\r\n     */\r\n   DailyTimetableControl.prototype.main = function () {\r\n        var self = this;    \r\n    \r\n        // Initialise width\r\n        self.refreshPeriodLayout();\r\n        self.region.removeClass('isloading');\r\n\r\n        self.navigatePreviousDay();\r\n        self.navigateNextDay();\r\n        self.timetableVisibility();\r\n        \r\n        // Watch resize to adjust width\r\n        $(window).on('resize', function(){\r\n            self.refreshPeriodLayout();\r\n        });\r\n\r\n        //Subscribe to nav drawer event and resize when it completes\r\n        PubSub.subscribe('nav-drawer-toggle-end', function(el){\r\n            Log.debug('resizing timetable');\r\n            self.refreshPeriodLayout();\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Determine period widths.\r\n     *\r\n     * @method\r\n     */\r\n    DailyTimetableControl.prototype.refreshPeriodLayout = function () {\r\n        var self = this;\r\n           \r\n        var breakWidth = 70;\r\n        var numBreaks = self.region.data('num-breaks');\r\n        var timetableWidth = self.region.outerWidth() - (numBreaks*breakWidth);\r\n        var numPeriods = self.region.data('num-periods') - numBreaks;\r\n        var potentialWidth = timetableWidth / numPeriods;\r\n\r\n        self.region.removeClass('view-stacked');\r\n        self.region.removeClass('view-minimal');\r\n        self.region.removeClass('view-wrapped');\r\n        self.region.removeClass('view-full');\r\n\r\n        if ( timetableWidth < 520 || potentialWidth < 65 ) {\r\n            // At this point, it really needs to be stacked\r\n            self.setPeriodWidth('view-stacked',\"100%\",\"100%\");\r\n        } else if ( potentialWidth < 100 ) {\r\n            var evenPeriods = 2 * Math.round(numPeriods / 2); // it would work well over 2 lines, so wrap it\r\n            var potentialWidth = timetableWidth / evenPeriods;\r\n            self.setPeriodWidth('view-minimal view-wrapped',potentialWidth*2 + \"px\",breakWidth + \"px\");\r\n        } else if ( potentialWidth < 180 ) {\r\n            // Works nicely on one line if minimised\r\n            self.setPeriodWidth('view-minimal', potentialWidth + \"px\",breakWidth + \"px\");\r\n        } else {\r\n            // Works nicely on one line\r\n            self.setPeriodWidth('view-full', potentialWidth + \"px\",breakWidth + \"px\");\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set period widths.\r\n     *\r\n     * @method\r\n     */\r\n    DailyTimetableControl.prototype.setPeriodWidth = function (classes, periodWidth, breakWidth) {\r\n        var self = this;\r\n        self.region.addClass(classes);\r\n        self.region.find('.period').css({\"width\": periodWidth});\r\n        self.region.find('.period.break').css({\"width\": breakWidth});\r\n    };\r\n    \r\n     /**\r\n     * Navigate to previous day.\r\n     *\r\n     * @method\r\n     */\r\n    DailyTimetableControl.prototype.navigatePreviousDay = function () {\r\n        var self = this;    \r\n        var instanceid = parseInt(self.instanceid);\r\n      \r\n        $('#inst' + instanceid + '.block_my_day_timetable').on('click', '.timetable-prev', function () {\r\n            self.region.addClass('fetchingdata');\r\n            Ajax.call([{\r\n                methodname: 'block_my_day_timetable_get_timetable_for_date',\r\n                args: {\r\n                    timetableuser: self.username, \r\n                    timetablerole: self.role, \r\n                    nav: 0,\r\n                    date: self.date, \r\n                    instanceid: instanceid\r\n                },\r\n                done:function(response){\r\n                    Log.debug(('Timetable values retrieved successfuly.')); \r\n                    self.refreshLayout(response.html); \r\n                },\r\n                fail: function(reason) {\r\n                    Log.error('block_my_day_timetable. NavigatePreviousDay: Unable to get timetable.');\r\n                    Log.debug(reason);\r\n                    self.timetableUnavailable();\r\n                }\r\n            }]);     \r\n        });\r\n    };\r\n    \r\n    /**\r\n     * Navigate to Next day.\r\n     *\r\n     * @method\r\n     */\r\n    DailyTimetableControl.prototype.navigateNextDay = function () {\r\n        var self = this;\r\n        var instanceid = parseInt(self.instanceid);\r\n\r\n        $('#inst' + instanceid + '.block_my_day_timetable').on('click', '.timetable-next', function () {\r\n            self.region.addClass('fetchingdata');\r\n            Log.debug('Nav next day user: ' + self.user + ' Role: ' + self.role + ' Date: ' + self.date + 'instanceid' + instanceid);\r\n            Ajax.call([{\r\n                methodname: 'block_my_day_timetable_get_timetable_for_date',\r\n                args: {\r\n                    timetableuser: self.username, \r\n                    timetablerole: self.role,\r\n                    nav: 1, \r\n                    date: self.date, \r\n                    instanceid: self.instanceid\r\n                },\r\n                done:function(response){\r\n                    Log.debug(('Timetable values retrieved successfuly.'));   \r\n                    self.refreshLayout(response.html);\r\n                },\r\n               fail: function(reason) {\r\n                    Log.error('block_my_day_timetable. NavigateNextDay: Unable to get timetable.');\r\n                    Log.debug(reason);\r\n                    self.timetableUnavailable();\r\n                }\r\n            }]);  \r\n        });\r\n    };\r\n    \r\n    /**\r\n     * Hide/show Timetable\r\n     *\r\n     * @method\r\n     */\r\n    DailyTimetableControl.prototype.timetableVisibility = function(){\r\n        var self = this;\r\n        \r\n        // Close\r\n        $('#inst' + self.instanceid + '.block_my_day_timetable').on('click', '.timetable-invisible', function () {\r\n            self.region.removeClass('timetable-maximised');\r\n            self.region.addClass('timetable-minimised');\r\n\r\n            //Title\r\n            self.region.find('.timetable-title').text(self.title);\r\n            \r\n            self.savePreferences(1);\r\n        });\r\n        \r\n        // Open\r\n        $('#inst' + self.instanceid + '.block_my_day_timetable').on('click', '.timetable-visible', function () {\r\n            self.region.removeClass('timetable-minimised');\r\n            self.region.addClass('timetable-maximised');\r\n            \r\n            //Title\r\n            self.region.find('.timetable-title').text(self.region.data('timetableday'));\r\n            \r\n            self.savePreferences(0);\r\n            self.refreshPeriodLayout();\r\n        });\r\n      \r\n    };\r\n    \r\n    DailyTimetableControl.prototype.savePreferences = function(value)    {\r\n        var self = this;\r\n\r\n        var preferences = [{\r\n            'name': 'block_my_day_timetable_collapsed',\r\n            'value': value,\r\n            'userid': self.userid,\r\n        }];\r\n\r\n        Ajax.call([{\r\n            methodname: 'core_user_set_user_preferences',\r\n            args: {preferences: preferences},\r\n            done: function () {\r\n                Log.debug('Preference saved');                     \r\n            }\r\n        }]);\r\n    };\r\n\r\n    /**\r\n     * This refresh is use when navigating the timetable\r\n     *\r\n     * @method\r\n     **/\r\n    DailyTimetableControl.prototype.refreshLayout = function(htmlResult){\r\n        var self = this;\r\n\r\n        self.region.fadeOut(300, function() {\r\n            self.region.replaceWith(htmlResult);\r\n            self.region.show();\r\n            self.region =  $('[data-region=\"block_my_day_timetable-instance-' + self.instanceid +'\"]');\r\n            self.date = self.region.data(\"timetabledate\");\r\n            self.region.removeClass('isloading');\r\n            self.region.removeClass('fetchingdata');\r\n            self.refreshPeriodLayout();\r\n        });\r\n    };\r\n\r\n    DailyTimetableControl.prototype.timetableUnavailable = function() {\r\n        var self = this;\r\n        \r\n        var unavailablestr = Str.get_string('timetableunavailable', 'block_my_day_timetable');\r\n        $.when(unavailablestr).done(function(localizedString) {\r\n            self.region.replaceWith('<h5>' + localizedString + '</h5>'); \r\n        });\r\n    };\r\n\r\n    return {\r\n        init: init\r\n    };\r\n});"],"file":"control.min.js"}